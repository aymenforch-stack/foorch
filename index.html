<!DOCTYPE html>
<html>
<head>
    <title>âš¡ Ø´Ø§Ø´Ø© Ù…Ø¨Ø§Ø´Ø±Ø©</title>
    <meta charset="UTF-8">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: white;
            height: 100vh;
            overflow: hidden;
        }
        
        /* Ø´Ø§Ø´Ø© ØªØ­Ù…ÙŠÙ„ Ø£ÙˆÙ„ÙŠØ© */
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #1a1a1a;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s;
        }
        
        .loader {
            width: 50px;
            height: 50px;
            border: 5px solid #333;
            border-top: 5px solid #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        #mainScreen {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª */
        .info-bar {
            background: #2a2a2a;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #4CAF50;
        }
        
        .room-info {
            font-size: 18px;
        }
        
        .room-code {
            background: #4CAF50;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
        }
        
        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ */
        .video-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            background: black;
            position: relative;
            overflow: hidden;
        }
        
        video {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        /* ØªØ³Ù…ÙŠØ© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ */
        .video-label {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
        }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­ÙƒÙ… */
        .control-bar {
            background: #2a2a2a;
            padding: 15px;
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        
        .control-btn {
            background: #333;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .control-btn:hover {
            background: #444;
            transform: scale(1.05);
        }
        
        .btn-share {
            background: #4CAF50;
        }
        
        .btn-stop {
            background: #f44336;
        }
        
        .btn-end {
            background: #ff9800;
        }
        
        /* Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ */
        .connection-status {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 10;
        }
        
        /* Ø¥Ø´Ø¹Ø§Ø±Ø§Øª */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 1001;
            animation: slideIn 0.3s ease;
            max-width: 300px;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø© */
        @media (max-width: 768px) {
            .control-bar {
                flex-wrap: wrap;
            }
            
            .control-btn {
                padding: 15px 20px;
                font-size: 14px;
            }
            
            .room-info {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
    <div id="loadingScreen">
        <div class="loader"></div>
        <h2>Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©...</h2>
        <p id="loadingText">ÙŠØªÙ… Ù…Ø´Ø§Ø±ÙƒØ© Ø´Ø§Ø´ØªÙƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</p>
    </div>
    
    <!-- Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div id="mainScreen" style="display: none;">
        <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª -->
        <div class="info-bar">
            <div class="room-info">
                <span id="userRole">ğŸ‘¤ Ù…Ø´Ø§Ø±Ùƒ Ø§Ù„Ø´Ø§Ø´Ø©</span>
            </div>
            <div class="room-code" id="roomCode" onclick="copyRoomLink()">
                ğŸ”— Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·
            </div>
        </div>
        
        <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ -->
        <div class="video-container">
            <div class="video-label" id="videoLabel">Ø´Ø§Ø´ØªÙƒ</div>
            <video id="screenVideo" autoplay playsinline></video>
            
            <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ -->
            <div class="connection-status" id="connectionStatus">
                âš¡ Ø¬Ø§Ø±ÙŠ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø©...
            </div>
        </div>
        
        <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­ÙƒÙ… -->
        <div class="control-bar">
            <button class="control-btn btn-share" onclick="toggleShare()" id="shareBtn">
                ğŸ–¥ï¸ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø©
            </button>
            
            <button class="control-btn" onclick="toggleAudio()" id="audioBtn">
                ğŸ”Š ØµÙˆØª
            </button>
            
            <button class="control-btn btn-end" onclick="endSession()">
                âŒ Ø¥Ù†Ù‡Ø§Ø¡
            </button>
        </div>
    </div>
    
    <script>
        // ============ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ============
        let screenStream = null;
        let peerConnection = null;
        let socket = null;
        let roomId = null;
        let userId = null;
        let isSharing = false;
        let isAudioEnabled = true;
        let isHost = false;
        
        // ============ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ============
        window.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚...');
            
            // ØªÙˆÙ„ÙŠØ¯ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            userId = generateUserId();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ø¹Ù„Ù…Ø§Øª URL
            const urlParams = new URLSearchParams(window.location.search);
            roomId = urlParams.get('room');
            
            if (!roomId) {
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ roomØŒ ÙÙ‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£ÙˆÙ„ (Ù…Ø´Ø§Ø±Ùƒ Ø§Ù„Ø´Ø§Ø´Ø©)
                roomId = generateRoomId();
                isHost = true;
                window.history.replaceState({}, '', `?room=${roomId}`);
                
                // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                document.getElementById('userRole').textContent = 'ğŸ‘¤ Ù…Ø´Ø§Ø±Ùƒ Ø§Ù„Ø´Ø§Ø´Ø©';
                document.getElementById('videoLabel').textContent = 'Ø´Ø§Ø´ØªÙƒ';
                
                // Ø¨Ø¯Ø¡ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                setTimeout(() => {
                    startScreenShare();
                }, 1000);
                
            } else {
                // Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ (Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯)
                isHost = false;
                document.getElementById('userRole').textContent = 'ğŸ‘ï¸ Ù…Ø´Ø§Ù‡Ø¯';
                document.getElementById('videoLabel').textContent = 'Ø´Ø§Ø´Ø© Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±';
                document.getElementById('shareBtn').style.display = 'none';
                
                // Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„ØºØ±ÙØ© ÙƒÙ…Ø´Ø§Ù‡Ø¯
                connectAsViewer();
            }
            
            // ØªØ­Ø¯ÙŠØ« ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©
            document.getElementById('roomCode').textContent = `ğŸ”— ${roomId}`;
            
            // Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ø°Ø§ ÙƒØ§Ù† host
            if (isHost) {
                copyRoomLink();
            }
        });
        
        // ============ Ø¯Ø§Ù„Ø© Ø¨Ø¯Ø¡ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø© ============
        async function startScreenShare() {
            try {
                updateLoadingText('Ø¬Ø§Ø±ÙŠ Ø·Ù„Ø¨ Ø¥Ø°Ù† Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø©...');
                
                // Ø·Ù„Ø¨ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø© Ù…Ø¨Ø§Ø´Ø±Ø©
                screenStream = await navigator.mediaDevices.getDisplayMedia({
                    video: {
                        cursor: "always",
                        displaySurface: "monitor"
                    },
                    audio: true
                });
                
                // Ø¹Ø±Ø¶ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
                const videoElement = document.getElementById('screenVideo');
                videoElement.srcObject = screenStream;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©
                isSharing = true;
                updateStatus('âœ… ØªÙ… Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø© Ø¨Ù†Ø¬Ø§Ø­');
                updateLoadingText('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ÙŠÙ†...');
                
                // Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø®Ø§Ø¯Ù… Ø§Ù„Ø¥Ø´Ø§Ø±Ø©
                connectToSignalingServer();
                
                // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('loadingScreen').style.display = 'none';
                        document.getElementById('mainScreen').style.display = 'flex';
                    }, 500);
                }, 1500);
                
                // Ø¹Ù†Ø¯ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
                screenStream.getVideoTracks()[0].onended = () => {
                    stopSharing();
                };
                
            } catch (error) {
                console.error('âŒ ÙØ´Ù„ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø©:', error);
                updateLoadingText('ÙØ´Ù„ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø©. ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© ÙˆØ§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
                
                // Ø¹Ø±Ø¶ Ø²Ø± Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
                setTimeout(() => {
                    document.getElementById('loadingText').innerHTML = 
                        'ÙØ´Ù„ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø©. <button onclick="location.reload()" style="background:#4CAF50;color:white;border:none;padding:8px 15px;border-radius:5px;margin-top:10px;cursor:pointer;">ğŸ”„ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button>';
                }, 2000);
            }
        }
        
        // ============ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø®Ø§Ø¯Ù… Ø§Ù„Ø¥Ø´Ø§Ø±Ø© ============
        function connectToSignalingServer() {
            // ÙÙŠ Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ù‡Ù†Ø§ ÙŠÙƒÙˆÙ† Ø§ØªØµØ§Ù„ WebSocket
            // Ù„Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆØ¶ÙŠØ­ÙŠØŒ Ø³Ù†Ø­Ø§ÙƒÙŠ Ø§Ù„Ø§ØªØµØ§Ù„
            
            updateStatus('ğŸ“¡ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ÙŠÙ†...');
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø§ØªØµØ§Ù„ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ÙŠÙ†
            simulateViewerConnections();
        }
        
        // ============ Ø§Ù„Ø§ØªØµØ§Ù„ ÙƒÙ…Ø´Ø§Ù‡Ø¯ ============
        function connectAsViewer() {
            updateLoadingText(`Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨ØºØ±ÙØ© ${roomId}...`);
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø§ØªØµØ§Ù„ Ù…Ø¹ Ù…Ø´Ø§Ø±Ùƒ Ø§Ù„Ø´Ø§Ø´Ø©
            setTimeout(() => {
                updateLoadingText('âœ… Ù…ØªØµÙ„! Ø¬Ø§Ø±ÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø§Ø´Ø©...');
                
                // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
                setTimeout(() => {
                    document.getElementById('loadingScreen').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('loadingScreen').style.display = 'none';
                        document.getElementById('mainScreen').style.display = 'flex';
                        
                        // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø´Ø§Ø´Ø© Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±
                        simulateReceivingScreen();
                    }, 500);
                }, 2000);
                
            }, 1500);
        }
        
        // ============ Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø´Ø§Ø´Ø© ============
        function simulateReceivingScreen() {
            updateStatus('ğŸ“º ØªØ´Ø§Ù‡Ø¯ Ø§Ù„Ø¢Ù† Ø´Ø§Ø´Ø© Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±');
            
            // Ø¥Ù†Ø´Ø§Ø¡ ÙÙŠØ¯ÙŠÙˆ ØªØ¬Ø±ÙŠØ¨ÙŠ (ÙÙŠ Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ø³ÙŠÙƒÙˆÙ† Ø¨Ø« WebRTC)
            createDemoVideo();
            
            // Ø¥Ø´Ø¹Ø§Ø±
            showNotification('ğŸ‘ï¸ Ø£Ù†Øª Ø§Ù„Ø¢Ù† ØªØ´Ø§Ù‡Ø¯ Ø´Ø§Ø´Ø© Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±');
        }
        
        // ============ Ø¥Ù†Ø´Ø§Ø¡ ÙÙŠØ¯ÙŠÙˆ ØªØ¬Ø±ÙŠØ¨ÙŠ ============
        function createDemoVideo() {
            const videoElement = document.getElementById('screenVideo');
            
            // Ø¥Ù†Ø´Ø§Ø¡ canvas ÙƒÙ…ØµØ¯Ø± Ù„Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ
            const canvas = document.createElement('canvas');
            canvas.width = 800;
            canvas.height = 600;
            const ctx = canvas.getContext('2d');
            
            // Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø³Ù…
            function drawDemoScreen() {
                // Ø®Ù„ÙÙŠØ©
                ctx.fillStyle = '#f0f0f0';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Ø³Ø·Ø­ Ù…ÙƒØªØ¨ ÙˆÙ‡Ù…ÙŠ
                ctx.fillStyle = '#1e3a8a';
                ctx.fillRect(50, 50, 700, 400);
                
                // Ù†ÙˆØ§ÙØ°
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(100, 100, 300, 200);
                ctx.fillStyle = '#3b82f6';
                ctx.fillRect(110, 110, 280, 30);
                ctx.fillStyle = '#000';
                ctx.font = '16px Arial';
                ctx.fillText('Ù…ØªØµÙØ­ Chrome', 120, 135);
                
                // Ù…Ø¤Ø´Ø± Ù…Ø§ÙˆØ³ Ù…ØªØ­Ø±Ùƒ
                const time = Date.now() / 1000;
                const mouseX = 200 + Math.sin(time) * 100;
                const mouseY = 200 + Math.cos(time) * 100;
                
                ctx.fillStyle = '#dc2626';
                ctx.beginPath();
                ctx.moveTo(mouseX, mouseY);
                ctx.lineTo(mouseX + 10, mouseY + 20);
                ctx.lineTo(mouseX + 5, mouseY + 20);
                ctx.lineTo(mouseX, mouseY + 15);
                ctx.closePath();
                ctx.fill();
                
                // ØªØ­ÙˆÙŠÙ„ canvas Ø¥Ù„Ù‰ stream
                canvas.captureStream(15);
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ù…
            setInterval(drawDemoScreen, 1000/15);
            
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… canvas ÙƒÙ…ØµØ¯Ø± Ù„Ù„ÙÙŠØ¯ÙŠÙˆ
            const stream = canvas.captureStream(15);
            videoElement.srcObject = stream;
        }
        
        // ============ Ù…Ø­Ø§ÙƒØ§Ø© Ø§ØªØµØ§Ù„ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯ÙŠÙ† ============
        function simulateViewerConnections() {
            let viewerCount = 0;
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø¯Ø®ÙˆÙ„ Ù…Ø´Ø§Ù‡Ø¯ÙŠÙ†
            const interval = setInterval(() => {
                viewerCount++;
                updateStatus(`ğŸ‘ï¸ ${viewerCount} Ù…Ø´Ø§Ù‡Ø¯ Ù…ØªØµÙ„`);
                
                if (viewerCount >= 3) {
                    clearInterval(interval);
                }
            }, 2000);
            
            // Ø¥Ø´Ø¹Ø§Ø±
            setTimeout(() => {
                showNotification('ğŸ“¤ Ø´Ø§Ø´ØªÙƒ ØªØ¸Ù‡Ø± Ø§Ù„Ø¢Ù† Ù„Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±');
            }, 3000);
        }
        
        // ============ ØªØ¨Ø¯ÙŠÙ„ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø© ============
        function toggleShare() {
            if (isSharing) {
                stopSharing();
            } else {
                startScreenShare();
            }
        }
        
        // ============ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ============
        function stopSharing() {
            if (screenStream) {
                screenStream.getTracks().forEach(track => track.stop());
                screenStream = null;
            }
            
            isSharing = false;
            updateStatus('â¸ï¸ ØªÙˆÙ‚ÙØª Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø©');
            document.getElementById('shareBtn').innerHTML = 'ğŸ–¥ï¸ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©';
            
            showNotification('â¸ï¸ ØªÙˆÙ‚ÙØª Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø´Ø§Ø´Ø©');
        }
        
        // ============ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØµÙˆØª ============
        function toggleAudio() {
            if (screenStream) {
                isAudioEnabled = !isAudioEnabled;
                screenStream.getAudioTracks().forEach(track => {
                    track.enabled = isAudioEnabled;
                });
                
                document.getElementById('audioBtn').innerHTML = 
                    isAudioEnabled ? 'ğŸ”Š ØµÙˆØª' : 'ğŸ”‡ ØµØ§Ù…Øª';
                
                showNotification(isAudioEnabled ? 'ğŸ”Š ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª' : 'ğŸ”‡ ØªÙ… ÙƒØªÙ… Ø§Ù„ØµÙˆØª');
            }
        }
        
        // ============ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø© ============
        function endSession() {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©ØŸ')) {
                if (screenStream) {
                    screenStream.getTracks().forEach(track => track.stop());
                }
                
                // ÙÙŠ Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ø¥ØºÙ„Ø§Ù‚ Ø§ØªØµØ§Ù„Ø§Øª WebRTC ÙˆWebSocket
                
                // ØªÙˆØ¬ÙŠÙ‡ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                window.location.href = window.location.origin;
            }
        }
        
        // ============ Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„ØºØ±ÙØ© ============
        function copyRoomLink() {
            const link = `${window.location.origin}${window.location.pathname}?room=${roomId}`;
            
            navigator.clipboard.writeText(link).then(() => {
                showNotification('ğŸ“‹ ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©');
                document.getElementById('roomCode').textContent = 'âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø®!';
                
                setTimeout(() => {
                    document.getElementById('roomCode').textContent = `ğŸ”— ${roomId}`;
                }, 2000);
            });
        }
        
        // ============ Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ============
        function generateRoomId() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }
        
        function generateUserId() {
            return 'user_' + Math.random().toString(36).substr(2, 6);
        }
        
        function updateStatus(message) {
            document.getElementById('connectionStatus').textContent = message;
        }
        
        function updateLoadingText(message) {
            document.getElementById('loadingText').textContent = message;
        }
        
        function showNotification(message) {
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
            const oldNotifications = document.querySelectorAll('.notification');
            oldNotifications.forEach(n => n.remove());
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†ÙŠ
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        // ============ Ø¯Ø¹Ù… Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø© ============
        if ('ontouchstart' in window) {
            document.querySelectorAll('.control-btn').forEach(btn => {
                btn.style.padding = '15px 20px';
                btn.style.fontSize = '14px';
            });
        }
    </script>
</body>
</html>